# Redis

## 1.Redis可以用来做什么?

​      1.最常用来做缓存,实现分布式缓存的中间件

​      2.作为数据库,性能要求极高的互联网需求

​      3.计算工具

​      4.实现分布式锁,作为消息队列使用



## 2.Redis和传统的关系型数据库有什么不同?

​      Redis:基于键值对的NoSQL数据库,键值对的值由多种数据结构和算法组成。数据存储于内存总。

​      关系型数据库:基于二维数据表来存储数据,支持关系查询。数据存储于磁盘上。



## 3.Redis有哪些数据类型?

​      5种:字符串,哈希,列表,集合,有序集合

​      5.0新增Streams数据类型,功能强大、支持多播、可持久化的消息队列。



## 4.Redis是单线程的,为什么还能这么快?

​      1.大部分操作在内存上完成(重要原因)

​      2.避免线程切换和竞争所产生的消耗

​      3.采用IO多路复用机制



## 5.Redis在持久化时fork出一个子进程,这时已经有两个进程了,怎么能说是单线程呢?

​        Redis是单线程的,主要是指Redis的网络IO和键值对读写是由一个线程来完成的。而Redis的其他功能,如持久化、异步删除、集群数据同步等,则是依赖其他线程来执行的。



## 6.set和zset有什么区别?

set:

​     元素无序、不可重复,最多2^32-1个元素

​     除了增删改查外,还支持对多个集合取交集、并集、差集

zset:

​     不可重复

​     为每个元素设置一个分数,并以此作为排序的依据

​     不能包含相同的元素,但分数可以相同



## 7.说一下Redis中的watch命令

​        确保事务中的数据没有被其他客户端修改才执行该事务,一种乐观锁的机制。监视一个key或者多个,如果这些key发生了变化,则服务器将拒绝执行客户端提交的事务



## 8.说说Redis中List结构的相关操作

线性有序,内部的元素可重复,一个列最多能存储2^32-1个元素

lpush/rpush:从列表的左侧/右侧添加数据

lrange:指定索引范围,并返回这个范围内的数据
​lindex:返回指定索引处的数据

lpop/rpop:从列表的左侧/右侧弹出一个数据

blpop/brpop:从列表的左侧/右侧弹出一个数据,若列表为空则进入阻塞状态



## 9.你要如何设计Redis的过期时间?

​      1.热点数据不设置过期时间,可以避免缓存击穿问题

​      2.设置过期时间时,附加一个随机数,避免大量的key同时过期,导致缓存雪崩



## 10.Redis中,setnx命令的返回值是什么,如何使用该命令实现分布式锁?

setnx命令返回整数值,返回1时表示设置值成功,返回0时表示设置值失败(key已存在)

优化后的命令:

​        加锁:

​                set key random-value nx ex seconds

​        解锁:

​                if redis.call("get",KEYS[1]) == ARGV[1] then

​                          return redis.call("del",KEYS[1])

​               else

​                         return 0

​               end



## 11.说一说Redis的持久化策略

Redis支持RDB持久化、AOF持久化、RDB-AOF混合持久化这三种持久化方式

RDB:

​        默认采用的持久化方式。以快照方式将进程数据持久化到硬盘中

两种触发方式:

​        手动触发:通过SAVE或BGSAVE命令触发RDB持久化操作

​       自动触发:通过配置选项,让服务器在满足指定条件时自动执行BGSAVE命令
​RDB持久化的优缺点如下:

​        优点:RDB生成紧凑压缩的二进制文件,体积小,使用该文件恢复数据的速度非常快

​        缺点:没做到实时的持久化

AOF:

​        解决了数据持久化的实时性,目前Redis持久化的主流方式。

AOF的工作流程包括:命令写入(append)、文件同步(sync)、文件重写(rewrite)、重启加载(reload)

AOF持久化的优缺点如下:

​       优点:AOF持久化的安全性要高,通过everysec选项,用户可以将数据丢失的时间窗口限制在1秒之内。

​       缺点:需要通过执行AOF文件中的命令来恢复数据库,其恢复速度比RDB慢很多,AOF文件存储的是协议文本,体积大

RDB-AOF混合持久化:

​       遵循以下原则:像执行BGSAVE命令一样,根据数据库当前的状态生成相应的RDB数据,并将其写入AOF文件中

​       对于重写之后执行的Redis命令,则以协议文本的方式追加到AOF文件的末尾,即RDB数据之后

​         



